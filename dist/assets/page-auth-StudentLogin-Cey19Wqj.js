import{r as m,j as a}from"./vendor_react-DCpd0Dq0.js";import{S as v}from"./page-LandingPage.tsx-index-BSx3ZgHx.js";import{c as N}from"./vendor-DcDhwVwZ.js";const P="https://sxnbiecxcyebzgrjuudv.supabase.co",U="sb_publishable_jSSuzzNQKAg3kyZ_vudp0Q_OVwB3UXb",n=N(P,U);async function S(e,s){return n.auth.signUp({email:e,password:s})}async function h(e,s){return n.auth.signInWithPassword({email:e,password:s})}async function C(){return n.auth.signOut()}async function q(){return n.from("lessons").select("*")}async function I(e){return n.from("student_progress").select("*").eq("student_id",e)}async function L(e){return n.from("student_progress").upsert(e,{onConflict:["student_id","lesson_id","phase","activity"]})}async function k(e){return n.from("responses").insert(e)}async function A(e){let s=n.from("responses").select("*");return e?.student_id&&(s=s.eq("student_id",e.student_id)),e?.question_id&&(s=s.eq("question_id",e.question_id)),s}async function z(e){return n.from("class_students").select("student_id").eq("class_id",e)}async function w(e){const s=await n.from("users").select("*").eq("id",e).limit(1).maybeSingle();if(s.data)return s.data;const t=await n.from("users").select("*").ilike("email",e).limit(1).maybeSingle();if(t.data)return t.data;const r=await n.from("users").select("*").ilike("name",e).limit(1).maybeSingle();return r.data?r.data:null}async function B(e,s,t){try{const r=t.match(/^data:(.+);base64,(.*)$/);if(!r)throw new Error("Invalid data URL");const o=r[1],u=r[2],c=Uint8Array.from(atob(u),f=>f.charCodeAt(0)),d=new Blob([c],{type:o}),l=new File([d],s.split("/").pop()||s,{type:o}),i=await n.storage.from(e).upload(s,l,{upsert:!0});if(i.error)throw i.error;return{publicUrl:n.storage.from(e).getPublicUrl(s).data.publicUrl}}catch(r){return{error:r}}}const $=Object.freeze(Object.defineProperty({__proto__:null,getClassStudents:z,getLessons:q,getProgressForStudent:I,getResponses:A,getUserProfileByIdentifier:w,saveProgress:L,signIn:h,signOut:C,signUp:S,submitResponse:k,supabase:n,uploadDataUrlToStorage:B},Symbol.toStringTag,{value:"Module"})),_={john_doe:"doe123",jane_smith:"smith456",student_001:"pass001"},E=async(e,s)=>{try{if(e.includes("@")){const t=await h(e,s);return t.error?!1:!!t.data?.session}}catch{}try{const t=localStorage.getItem("studentDatabase");if(((t?JSON.parse(t):_)[e]||"")===s)return!0}catch{}return!1},F=async(e,s,t)=>{try{if(s.includes("@")){if((await S(s,t)).error)return{success:!1,reason:"supabase"};try{await n.from("users").insert({email:s,name:e,role:"student"})}catch{}return{success:!0}}}catch{return{success:!1,reason:"supabase"}}try{const r=localStorage.getItem("studentDatabase"),o=r?JSON.parse(r):_;return o[s]?{success:!1,reason:"exists"}:(o[s]=t,localStorage.setItem("studentDatabase",JSON.stringify(o)),{success:!0})}catch{return{success:!1,reason:"quota"}}},T=(e,s,t)=>{const r=i=>i.trim().toLowerCase().replace(/[^a-z0-9]+/g,""),o=r(e.split(/\s+/)[0]||"student"),u=s.trim().split(/\s+/),c=r(u[u.length-1]||"user"),d=`${o}_${c}`,l=`${c}${t}`;return{username:d,password:l}},J=({onLogin:e,onBack:s})=>{const[t,r]=m.useState(""),[o,u]=m.useState(""),[c,d]=m.useState(!1),[l,i]=m.useState(""),[g,f]=m.useState(!1),x=async p=>{if(p.preventDefault(),i(""),f(!0),t==="sirmarco"&&o==="101997"){e(t,"admin"),f(!1);return}try{if(t.includes("@"))if((await h(t,o)).error)i("Invalid credentials. Please contact your teacher for login details.");else{const y=await w(t),j=y&&y.role||"student";e(t,j)}else await E(t,o)?e(t,"student"):i("Invalid credentials. Please contact your teacher for login details.")}catch(b){i("Login failed. Please try again."),console.error("validateStudentCredentials error",b)}finally{f(!1)}};return a.jsxs("div",{className:"auth-container",children:[a.jsx("button",{className:"back-button",onClick:s,children:"â† Back"}),a.jsxs("div",{className:"auth-card",children:[a.jsx("div",{className:"auth-icon",children:a.jsx(v,{size:56})}),a.jsx("h2",{children:"Student Login"}),a.jsxs("form",{onSubmit:x,children:[a.jsxs("div",{className:"form-group",children:[a.jsx("label",{htmlFor:"username",children:"Username"}),a.jsx("input",{id:"username",type:"text",placeholder:"Enter your username",value:t,onChange:p=>r(p.target.value),required:!0})]}),a.jsxs("div",{className:"form-group password-group",children:[a.jsx("label",{htmlFor:"password",children:"Password"}),a.jsxs("div",{className:"password-input-wrapper",children:[a.jsx("input",{id:"password",type:c?"text":"password",placeholder:"Enter your password",value:o,onChange:p=>u(p.target.value),required:!0}),a.jsx("button",{type:"button",className:"password-toggle",onClick:()=>d(!c),children:c?"ğŸ‘ï¸":"ğŸ‘ï¸â€ğŸ—¨ï¸"})]})]}),l&&a.jsx("div",{className:"error-message",children:l}),a.jsx("button",{type:"submit",className:"login-button",disabled:g,children:g?"Logging in...":"Login"})]})]})]})};export{J as S,n as a,T as b,C as c,$ as d,w as g,F as r,h as s};
