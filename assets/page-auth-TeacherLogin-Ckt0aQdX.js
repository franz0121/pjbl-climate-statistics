import{r as t,j as e}from"./vendor_react-DCpd0Dq0.js";import{T as M}from"./page-LandingPage.tsx-index-BSx3ZgHx.js";import{s as b,a as C,b as z}from"./page-auth-StudentLogin-BYMRMq1C.js";const K=({onLogin:c,onBack:R})=>{const[i,E]=t.useState(""),[d,k]=t.useState(""),[p,T]=t.useState(!1),[u,a]=t.useState(""),[m,g]=t.useState(!1),[q,x]=t.useState(!1),[j,F]=t.useState(""),[n,I]=t.useState(""),[h,U]=t.useState(""),[l,L]=t.useState(""),[y,D]=t.useState(""),[N,P]=t.useState(""),S={username:"teacher01",password:"cbnhs"},A=s=>{s.preventDefault(),a(""),g(!0),(async()=>{try{if(i.includes("@"))(await b(i,d)).error?a("Invalid credentials. Please try again."):c(i,"teacher");else try{const r=await C.from("users").select("email, username, role").eq("username",i).maybeSingle();if(!r.error&&r.data&&r.data.email){const o=r.data.email;(await b(o,d)).error?a("Invalid credentials. Please try again."):c(r.data.username||o,"teacher")}else await new Promise(o=>setTimeout(o,500)),i===S.username&&d===S.password?c(i,"teacher"):a("Invalid credentials. Please try again.")}catch(r){console.error("Login lookup failed",r),a("Login failed. Please try again.")}}catch(r){a("Login failed. Please try again."),console.error(r)}finally{g(!1)}})()},B=async s=>{if(s.preventDefault(),a(""),!j||!n||!h||!l){a("Please fill all fields.");return}if(l!==y){a("Passwords do not match.");return}g(!0);try{const r=await z(n,l);if(r.error){a(r.error.message||"Registration failed");return}const w=(r.data?.user||r?.user||null)?.id||null;try{const f={email:n,name:j,username:h,role:"teacher"};w&&(f.id=w);const v=await C.from("users").insert(f).select().maybeSingle();if(v.error){a(v.error.message||"Profile insert failed"),console.warn("Profile insert failed",v.error);return}}catch(f){console.warn("Profile insert exception",f),a("Profile insert failed");return}if(!(await b(n,l)).error){c(h,"teacher");return}x(!1),P("Registration successful â€” check your email if verification is required."),setTimeout(()=>P(""),6e3)}catch(r){console.error(r),a("Registration failed.")}finally{g(!1)}};return e.jsxs("div",{className:"auth-container",children:[e.jsx("button",{className:"back-button",onClick:R,children:"â† Back"}),e.jsxs("div",{className:"auth-card",children:[e.jsx("div",{className:"auth-icon",children:e.jsx(M,{size:56})}),e.jsx("h2",{children:"Teacher Login"}),q?e.jsxs("form",{onSubmit:B,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"regName",children:"Full name"}),e.jsx("input",{id:"regName",type:"text",value:j,onChange:s=>F(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"regEmail",children:"Email"}),e.jsx("input",{id:"regEmail",type:"email",value:n,onChange:s=>I(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"regUsername",children:"Username"}),e.jsx("input",{id:"regUsername",type:"text",value:h,onChange:s=>U(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"regPassword",children:"Password"}),e.jsx("input",{id:"regPassword",type:"password",value:l,onChange:s=>L(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"regConfirm",children:"Confirm password"}),e.jsx("input",{id:"regConfirm",type:"password",value:y,onChange:s=>D(s.target.value),required:!0})]}),u&&e.jsx("div",{className:"error-message",children:u}),e.jsxs("div",{className:"auth-actions",children:[e.jsx("button",{type:"button",className:"link-button",onClick:()=>{x(!1),a("")},children:"Back to login"}),e.jsx("button",{type:"submit",className:"login-button",disabled:m,children:m?"Registering...":"Register"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:A,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"username",children:"Username"}),e.jsx("input",{id:"username",type:"text",placeholder:"Enter your username",value:i,onChange:s=>E(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group password-group",children:[e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"password-input-wrapper",children:[e.jsx("input",{id:"password",type:p?"text":"password",placeholder:"Enter your password",value:d,onChange:s=>k(s.target.value),required:!0}),e.jsx("button",{type:"button",className:"password-toggle",onClick:()=>T(!p),children:p?"ðŸ‘ï¸":"ðŸ‘ï¸â€ðŸ—¨ï¸"})]})]}),u&&e.jsx("div",{className:"error-message",children:u}),e.jsx("button",{type:"submit",className:"login-button",disabled:m,children:m?"Logging in...":"Login"}),e.jsx("div",{className:"auth-toggle",children:e.jsx("button",{type:"button",className:"link-button",onClick:()=>{x(!0),a("")},children:"Register"})})]}),N&&e.jsx("div",{className:"toast",role:"status",children:N})]})]})]})};export{K as T};
