import{r,j as e}from"./vendor_react-DCpd0Dq0.js";import{T as D}from"./page-LandingPage.tsx-index-BSx3ZgHx.js";import{s as y,g as A,a as M,b as z}from"./page-auth-StudentLogin-DNlunNKf.js";const K=({onLogin:g,onBack:C})=>{const[n,P]=r.useState(""),[h,R]=r.useState(""),[p,S]=r.useState(!1),[l,a]=r.useState(""),[c,u]=r.useState(!1),[E,f]=r.useState(!1),[x,k]=r.useState(""),[i,T]=r.useState(""),[d,F]=r.useState(""),[o,U]=r.useState(""),[j,q]=r.useState(""),[w,v]=r.useState(""),b={username:"teacher01",password:"cbnhs"},I=s=>{s.preventDefault(),a(""),u(!0),(async()=>{try{if(n.includes("@"))if((await y(n,h)).error)a("Invalid credentials. Please try again.");else{const N=((await A(n))?.role==="teacher","teacher");g(n,"teacher")}else await new Promise(t=>setTimeout(t,500)),n===b.username&&h===b.password?g(n,"teacher"):a("Invalid credentials. Please try again.")}catch(t){a("Login failed. Please try again."),console.error(t)}finally{u(!1)}})()},L=async s=>{if(s.preventDefault(),a(""),!x||!i||!d||!o){a("Please fill all fields.");return}if(o!==j){a("Passwords do not match.");return}u(!0);try{const t=await M(i,o);if(t.error){a(t.error.message||"Registration failed");return}const N=(t.data?.user||t?.user||null)?.id||null;try{const m=await z.from("users").insert({id:N,email:i,name:x,username:d,role:"teacher"});m.error&&console.warn("Profile insert failed",m.error)}catch(m){console.warn("Profile insert exception",m)}if(!(await y(i,o)).error){g(d,"teacher");return}f(!1),v("Registration successful â€” check your email if verification is required."),setTimeout(()=>v(""),6e3)}catch(t){console.error(t),a("Registration failed.")}finally{u(!1)}};return e.jsxs("div",{className:"auth-container",children:[e.jsx("button",{className:"back-button",onClick:C,children:"â† Back"}),e.jsxs("div",{className:"auth-card",children:[e.jsx("div",{className:"auth-icon",children:e.jsx(D,{size:56})}),e.jsx("h2",{children:"Teacher Login"}),E?e.jsxs("form",{onSubmit:L,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"regName",children:"Full name"}),e.jsx("input",{id:"regName",type:"text",value:x,onChange:s=>k(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"regEmail",children:"Email"}),e.jsx("input",{id:"regEmail",type:"email",value:i,onChange:s=>T(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"regUsername",children:"Username"}),e.jsx("input",{id:"regUsername",type:"text",value:d,onChange:s=>F(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"regPassword",children:"Password"}),e.jsx("input",{id:"regPassword",type:"password",value:o,onChange:s=>U(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"regConfirm",children:"Confirm password"}),e.jsx("input",{id:"regConfirm",type:"password",value:j,onChange:s=>q(s.target.value),required:!0})]}),l&&e.jsx("div",{className:"error-message",children:l}),e.jsxs("div",{className:"auth-actions",children:[e.jsx("button",{type:"button",className:"link-button",onClick:()=>{f(!1),a("")},children:"Back to login"}),e.jsx("button",{type:"submit",className:"login-button",disabled:c,children:c?"Registering...":"Register"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:I,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"username",children:"Username"}),e.jsx("input",{id:"username",type:"text",placeholder:"Enter your username",value:n,onChange:s=>P(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group password-group",children:[e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"password-input-wrapper",children:[e.jsx("input",{id:"password",type:p?"text":"password",placeholder:"Enter your password",value:h,onChange:s=>R(s.target.value),required:!0}),e.jsx("button",{type:"button",className:"password-toggle",onClick:()=>S(!p),children:p?"ðŸ‘ï¸":"ðŸ‘ï¸â€ðŸ—¨ï¸"})]})]}),l&&e.jsx("div",{className:"error-message",children:l}),e.jsx("button",{type:"submit",className:"login-button",disabled:c,children:c?"Logging in...":"Login"}),e.jsx("div",{className:"auth-toggle",children:e.jsx("button",{type:"button",className:"link-button",onClick:()=>{f(!0),a("")},children:"Register"})})]}),w&&e.jsx("div",{className:"toast",role:"status",children:w})]})]})]})};export{K as T};
