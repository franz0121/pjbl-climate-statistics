import{R as L,j as e,r as p,a as C}from"./vendor_react-DCpd0Dq0.js";import{b as A,g as k,S as B,d as O}from"./page-auth-StudentLogin-DNlunNKf.js";import{L as v}from"./page-LandingPage.tsx-index-BSx3ZgHx.js";import{T as D}from"./page-auth-TeacherLogin-B66Vy7Dm.js";import{A as N}from"./page-auth-AdminLogin-Mad6eKNK.js";import{aN as S}from"./page-portals-StudentPortal-SwtZGgBI.js";import{P as R}from"./page-student_sections-PreAssessment-R_RaNsDw.js";import{L as T}from"./page-student_sections-Lesson1-DYq1Uzmx.js";import{L as U}from"./page-student_sections-Lesson2-BD9g9aUm.js";import{L as $}from"./page-student_sections-Lesson3-BpoPZesd.js";import{P as I}from"./page-student_sections-PostAssessment-5Td8ZT_K.js";import{P as J}from"./page-student_sections-PerformanceSummary-gjzzluY3.js";import{T as M,d as F}from"./page-portals-TeacherPortal-hkbjGoLF.js";import{A as q}from"./page-portals-AdminPortal-C2gygf1C.js";import"./vendor-DcDhwVwZ.js";import"./page-portals-PerformanceSummary-D6rdiWpS.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))u(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const m of i.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&u(m)}).observe(document,{childList:!0,subtree:!0});function r(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function u(t){if(t.ep)return;t.ep=!0;const i=r(t);fetch(t.href,i)}})();class K extends L.Component{constructor(n){super(n),this.state={hasError:!1}}static getDerivedStateFromError(n){return{hasError:!0,message:n?.message}}componentDidCatch(n,r){console.error("ErrorBoundary caught:",n,r)}render(){return this.state.hasError?this.props.fallback?e.jsxs("div",{children:[this.props.fallback,this.state.message&&e.jsx("div",{style:{padding:16},children:e.jsxs("p",{style:{color:"#ef4444"},children:[e.jsx("b",{children:"Error:"})," ",this.state.message]})})]}):e.jsxs("div",{style:{padding:24},children:[e.jsx("h2",{children:"Something went wrong in this section."}),e.jsx("p",{children:this.state.message||"An unexpected error occurred."})]}):this.props.children}}function z(){const[c,n]=p.useState("landing"),[r,u]=p.useState(null),[t,i]=p.useState([]),[m,g]=p.useState("overview");p.useEffect(()=>{const o=localStorage.getItem("teacherClasses");o&&i(JSON.parse(o)),(async()=>{try{const s=(await A.auth.getSession()).data?.session;if(s){const l=s.user,d=await k(l.email||l.id),x=d&&d.role||"student";u({username:d?.email||d?.name||l.id,role:x}),n(`${x}-portal`)}}catch{}})()},[]),p.useEffect(()=>{const o=s=>{try{localStorage.setItem("lastAppError",JSON.stringify({message:s.message,filename:s.filename,lineno:s.lineno,colno:s.colno,stack:s.error&&s.error.stack||null,time:Date.now()}))}catch{}},a=s=>{try{const l=s.reason instanceof Error?{message:s.reason.message,stack:s.reason.stack}:{reason:s.reason};localStorage.setItem("lastAppError",JSON.stringify({promiseRejection:!0,...l,time:Date.now()}))}catch{}};return window.addEventListener("error",o),window.addEventListener("unhandledrejection",a),()=>{window.removeEventListener("error",o),window.removeEventListener("unhandledrejection",a)}},[]),p.useEffect(()=>{try{console.log("[App] saving classes to localStorage",t),localStorage.setItem("teacherClasses",JSON.stringify(t))}catch(o){console.error("[App] failed saving classes",o)}},[t]);const y=o=>{n(`${o}-login`)},h=(o,a)=>{u({username:o,role:a}),n(`${a}-portal`)},f=()=>{try{O().catch(()=>{})}catch{}u(null),n("landing")},j=o=>{n(`student-section-${o}`)},E=(o,a)=>{const s=t.map(l=>({...l,students:l.students.map(d=>d.username===o?{...d,hasLoggedIn:!0}:d)}));i(s),u({username:o,role:a}),g("overview"),n(a==="admin"?"student-portal":`${a}-portal`)},b=(o,a)=>{const s={id:Date.now().toString(),grade:o,section:a,students:[]};i([...t,s])},w=(o,a)=>{console.log("[App] handleUpdateStudents called",{classId:o,students:a}),i(t.map(s=>s.id===o?{...s,students:a}:s))},P=o=>{const a=t.find(s=>s.id===o);if(a){const s=a.students.map(l=>l.username);F(o,s)}i(t.filter(s=>s.id!==o))};return e.jsxs("div",{className:"app",children:[c==="landing"&&e.jsx(v,{onRoleSelect:y}),c==="student-login"&&e.jsx(B,{onLogin:E,onBack:()=>n("landing")}),c==="teacher-login"&&e.jsx(D,{onLogin:h,onBack:()=>n("landing")}),c==="admin-login"&&e.jsx(N,{onLogin:h,onBack:()=>n("landing")}),c==="student-portal"&&r&&e.jsx(S,{user:r,onLogout:f,classes:t,onOpenSection:j,initialTab:m}),c==="student-section-1"&&r&&e.jsx(R,{user:r,onBack:()=>n("student-portal")}),c==="student-section-6"&&r&&e.jsx(J,{user:r,onBack:()=>{g("sections"),n("student-portal")}}),c==="student-section-2"&&r&&e.jsx(K,{fallback:e.jsxs("div",{style:{padding:24},children:[e.jsx("h2",{children:"Unable to load Lesson 1."}),e.jsx("p",{children:"Please go back and try again."}),e.jsx("button",{className:"back-btn",onClick:()=>{g("sections"),n("student-portal")},children:"Back to Dashboard"})]}),children:e.jsx(T,{user:r,onBack:()=>{g("sections"),n("student-portal")}})}),c==="student-section-3"&&r&&e.jsx(U,{user:r,onBack:()=>{g("sections"),n("student-portal")}}),c==="student-section-4"&&r&&e.jsx($,{user:r,onBack:()=>{g("sections"),n("student-portal")}}),c==="student-section-5"&&r&&e.jsx(I,{user:r,onBack:()=>n("student-portal")}),c==="teacher-portal"&&r&&e.jsx(M,{user:r,onLogout:f,classes:t,onCreateClass:b,onUpdateStudents:w,onDeleteClass:P}),c==="admin-portal"&&r&&e.jsx(q,{user:r,onLogout:f,classes:t}),r&&!["landing","student-login","teacher-login","admin-login","student-portal","student-section-1","student-section-2","student-section-3","student-section-4","student-section-5","student-section-6","teacher-portal","admin-portal"].includes(c)&&e.jsx(S,{user:r,onLogout:f,classes:t,onOpenSection:j,initialTab:m})]})}C.createRoot(document.getElementById("root")).render(e.jsx(L.StrictMode,{children:e.jsx(z,{})}));
