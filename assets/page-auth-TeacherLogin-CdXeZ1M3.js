import{r as t,j as e}from"./vendor_react-DCpd0Dq0.js";import{T as B}from"./page-LandingPage.tsx-index-BSx3ZgHx.js";import{s as w,a as P,b as M}from"./page-auth-StudentLogin-BYMRMq1C.js";const J=({onLogin:c,onBack:R})=>{const[i,S]=t.useState(""),[u,E]=t.useState(""),[f,k]=t.useState(!1),[d,a]=t.useState(""),[m,g]=t.useState(!1),[T,x]=t.useState(!1),[j,q]=t.useState(""),[n,F]=t.useState(""),[h,I]=t.useState(""),[l,U]=t.useState(""),[v,L]=t.useState(""),[b,y]=t.useState(""),N={username:"teacher01",password:"cbnhs"},D=s=>{s.preventDefault(),a(""),g(!0),(async()=>{try{if(i.includes("@"))(await w(i,u)).error?a("Invalid credentials. Please try again."):c(i,"teacher");else try{const r=await P.from("users").select("email, username, role").eq("username",i).maybeSingle();if(!r.error&&r.data&&r.data.email){const o=r.data.email;(await w(o,u)).error?a("Invalid credentials. Please try again."):c(r.data.username||o,"teacher")}else await new Promise(o=>setTimeout(o,500)),i===N.username&&u===N.password?c(i,"teacher"):a("Invalid credentials. Please try again.")}catch(r){console.error("Login lookup failed",r),a("Login failed. Please try again.")}}catch(r){a("Login failed. Please try again."),console.error(r)}finally{g(!1)}})()},A=async s=>{if(s.preventDefault(),a(""),!j||!n||!h||!l){a("Please fill all fields.");return}if(l!==v){a("Passwords do not match.");return}g(!0);try{const r=await M(n,l);if(r.error){a(r.error.message||"Registration failed");return}const C=(r.data?.user||r?.user||null)?.id||null;try{const p=await P.from("users").insert({id:C,email:n,name:j,username:h,role:"teacher"});p.error&&console.warn("Profile insert failed",p.error)}catch(p){console.warn("Profile insert exception",p)}if(!(await w(n,l)).error){c(h,"teacher");return}x(!1),y("Registration successful â€” check your email if verification is required."),setTimeout(()=>y(""),6e3)}catch(r){console.error(r),a("Registration failed.")}finally{g(!1)}};return e.jsxs("div",{className:"auth-container",children:[e.jsx("button",{className:"back-button",onClick:R,children:"â† Back"}),e.jsxs("div",{className:"auth-card",children:[e.jsx("div",{className:"auth-icon",children:e.jsx(B,{size:56})}),e.jsx("h2",{children:"Teacher Login"}),T?e.jsxs("form",{onSubmit:A,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"regName",children:"Full name"}),e.jsx("input",{id:"regName",type:"text",value:j,onChange:s=>q(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"regEmail",children:"Email"}),e.jsx("input",{id:"regEmail",type:"email",value:n,onChange:s=>F(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"regUsername",children:"Username"}),e.jsx("input",{id:"regUsername",type:"text",value:h,onChange:s=>I(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"regPassword",children:"Password"}),e.jsx("input",{id:"regPassword",type:"password",value:l,onChange:s=>U(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"regConfirm",children:"Confirm password"}),e.jsx("input",{id:"regConfirm",type:"password",value:v,onChange:s=>L(s.target.value),required:!0})]}),d&&e.jsx("div",{className:"error-message",children:d}),e.jsxs("div",{className:"auth-actions",children:[e.jsx("button",{type:"button",className:"link-button",onClick:()=>{x(!1),a("")},children:"Back to login"}),e.jsx("button",{type:"submit",className:"login-button",disabled:m,children:m?"Registering...":"Register"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:D,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"username",children:"Username"}),e.jsx("input",{id:"username",type:"text",placeholder:"Enter your username",value:i,onChange:s=>S(s.target.value),required:!0})]}),e.jsxs("div",{className:"form-group password-group",children:[e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"password-input-wrapper",children:[e.jsx("input",{id:"password",type:f?"text":"password",placeholder:"Enter your password",value:u,onChange:s=>E(s.target.value),required:!0}),e.jsx("button",{type:"button",className:"password-toggle",onClick:()=>k(!f),children:f?"ðŸ‘ï¸":"ðŸ‘ï¸â€ðŸ—¨ï¸"})]})]}),d&&e.jsx("div",{className:"error-message",children:d}),e.jsx("button",{type:"submit",className:"login-button",disabled:m,children:m?"Logging in...":"Login"}),e.jsx("div",{className:"auth-toggle",children:e.jsx("button",{type:"button",className:"link-button",onClick:()=>{x(!0),a("")},children:"Register"})})]}),b&&e.jsx("div",{className:"toast",role:"status",children:b})]})]})]})};export{J as T};
